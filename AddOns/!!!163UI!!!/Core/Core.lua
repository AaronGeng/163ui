local t,e=...local y=e.L local l,r,n,g=floor,ceil,format,tostring local i,s,m,p,h,a,u,c,k,v=pairs,ipairs,next,wipe,assert,type,tinsert,select,tremove,GetTime local o,f,w,b,d={},{},{},{"%.1f","%.2f","%.3f","%.4f","%.5f",[0]="%d"},{"0","00","000","0000","00000"}for e=0,100 do o[e]=g(e)end for e=0,9 do for t=0,9 do w[e+t/10]=n("%.1f",e+t/10)end end function noop()end _empty_table={};_temp_table={};function copy(t,e)e=e or{}if not t then return end for a,t in i(t)do e[a]=t;end return e;end function tremovedata(e,a)for t=#e,1,-1 do if e[t]==a then k(e,t)end end end function tinsertdata(e,t)for a=1,#e do if(e[a]==t)then return end end u(e,t);return true;end function escape(e)return e:gsub("%%","%%%%"):gsub("%-","%%-"):gsub("%+","%%+"):gsub("%.","%%."):gsub("%[","%%["):gsub("%]","%%]"):gsub("%(","%%("):gsub("%)","%%)");end function nocase(e)return string.gsub(e,"%a",function(e)return string.format("[%s%s]",string.lower(e),string.upper(e))end)end function uncolor(e)return e and e:gsub("|c%x%x%x%x%x%x%x%x(.-)|r","%1")or nil end local j=xpcall local function q(e)return geterrorhandler()(e)end local function x(o)local e=[[
		local xpcall, eh = ...
		local method, ARGS
		local function call() return method(ARGS) end

		local function dispatch(func, ...)
			method = func
			if not method then return end
			ARGS = ...
			return xpcall(call, eh)
		end

		return dispatch
	]]local a={}for t=1,o do a[t]="arg"..t end e=e:gsub("ARGS",table.concat(a,", "))return h(loadstring(e,"safecall Dispatcher["..o.."]"))(j,q)end local t=setmetatable({},{__index=function(a,t)local e=x(t)rawset(a,t,e)return e end})t[0]=function(e)return j(e,q)end function safecall(e,...)return t[c("#",...)](e,...)end function n2s_pad(t,e)e=e-#t if e>0 then return d[e]..t else return t end end local q={}for e=0,100 do q[e]=n("%02d",e)end function n2s(e,t,i)if e>=0 then if e<=100 then if t then if t==2 then return q[e]end local e=o[e]or o[(i and r or l)(e)]t=t-#e if t>0 then return d[t]..e else return e end else return o[e]or o[(i and r or l)(e)]end elseif e<=1e4 then local a=f[e]if not a then e=(i and r or l)(e)a=f[e]if not a then a=n("%d",e)f[(i and r or l)(e)]=a end end if t then t=t-#a if t>0 then return d[t]..a else return a end else return a end else return n("%d",e)end else return n("%d",e)end end function f2s(e,t)t=t or 0 if e>=0 and e<=100 and t<=1 then if t==0 then return o[l(e+.5)]else local t=w[l(e*10+.5)/10]if not t then t=n("%.1f",e)w[e]=t end return t end else return n(b[t]or b[0],e)end end local r,o,b,t,j,q=n2s,safecall,copy,tinsertdata,tremovedata,f2s LibStub("AceTimer-3.0"):Embed(e)function CoreScheduleTimer(i,a,o,t)if(i)then return e:ScheduleRepeatingTimer(o,a,t)else return e:ScheduleTimer(o,a,t)end end function CoreCancelTimer(t,a)return e:CancelTimer(t,a);end local t={}function CoreScheduleBucket(a,i,o,n)if t[a]then CoreCancelTimer(t[a])end t[a]=CoreScheduleTimer(false,i,function(...)t[a]=nil o(...)end,n)end e.frame=CreateFrame("Frame")local t=0 local d={}local f=0 local w=setmetatable({},{__newindex=function(e,t,a)rawset(e,t,a)f=f+1 end})e.frame:SetScript("OnUpdate",function(e)if f>0 then for e,t in m,w do o(t,e);w[e]=nil end f=0;end if t>0 then local a=t for e=1,a do local e=d[e];if e[1]then o(e[1],c(2,unpack(e)));end p(e);end t=t-a;for e=1,t do b(d[e+t],d[e]);p(d[e+t]);end end end)function RunOnNextFrame(a,...)t=t+1;local e=d[t];if(not e)then e={};d[t]=e;end e[1]=a;for t=1,c("#",...)do e[t+1]=c(t,...);end end function RunOnNextFrameKey(t,e)w[t]=e;end function RunOnNextFrameKeyCancel(e)w[e]=nil;end local d;function CoreDispatchEvent(i,e)i.addon=e or i;d=d or function(o,t,...)local e=o.addon[t];if(a(e)=="function")then e(o.addon,t,...);else e=o.addon.DEFAULT_EVENT;if(a(e)~="function")then print(y["没有事件["]..t..y["]的处理函数."]);return end e(o.addon,t,...);end end i:SetScript("OnEvent",d);end local t={}function CoreAddEvent(e)t[e]={};end function CoreRegisterEvent(e,a)local t=t[a];h(t,"No event '"..a.."' is defined.");u(t,WW and WW:un(e)or e._F or e);end function CoreUnregisterEvent(e,a)local t=t[a];h(t,"No event '"..a.."' is defined.");j(t,WW and WW:un(e)or e._F or e);end function CoreUnregisterAllEvents(a)for e,t in i(t)do CoreUnregisterEvent(a,e);end end function CoreFireEvent(a,...)local e=t[a];if(e)then for t=1,#e do local e=e[t]o(e[a],e,...);end end end function CoreDependCall(t,e,...)local e=a(e)=="function"and e or _G[e];local e=a(e)=="function"and e or _G[e];if(IsAddOnLoaded(t)and a(e)=="function")then e(...)else local a={...}CoreOnEvent("ADDON_LOADED",function(i,o)if(o==t)then e(unpack(a));return true;end end)end end local t={}function CoreLeaveCombatCall(i,n,e)local e=a(e)=="function"and e or _G[e];h(a(e)=="function","param #2 should be function or function name.")if not InCombatLockdown()then o(e,i)else if n then U1Message(n)end t[i]=e;end end local f={}local d,w={},false e.frame:RegisterEvent("PLAYER_REGEN_ENABLED")e.frame:SetScript("OnEvent",function(a,e,...)if e=="PLAYER_REGEN_ENABLED"then for t,e in m,t do o(e,t)end p(t);end local a=f[e];if a then local t=1;while t<=#a do local o,e=o(a[t],e,...);if o and e then k(a,t);else t=t+1;end end end local t=d[e]if t then for a=1,#t do local t=t[a]local a=t[3]if a==nil then o(t[1],e)t[3]=t[2]else t[4]=1 end end end end)CoreScheduleTimer(true,.2,function()if not w then return end for a,e in i(d)do for t=1,#e do local t=e[t]local e=t[3];if e then e=e-.1 if e<=0 then if t[4]then o(t[1],a);t[4]=nil;e=t[2];else e=nil end end t[3]=e end end end end)function CoreOnEvent(t,i,o)if o then if a(o)=="table"then o:RegisterEvent(t);o[t]=i;else local e=CreateFrame("Frame");CoreDispatchEvent(e)e:RegisterEvent(t);e[t]=i;return e;end end if(not e.frame:IsEventRegistered(t))then e.frame:RegisterEvent(t);end local e=f[t];if(e==nil)then e={}f[t]=e end u(e,i);end function CoreOnEventBucket(t,a,o)if(not e.frame:IsEventRegistered(t))then e.frame:RegisterEvent(t);end local e=d[t];if(e==nil)then e={}d[t]=e end u(e,{o,a,0})w=m(d)and true end function dump(...)if not IsAddOnLoaded("Blizzard_DebugTools")then LoadAddOn("Blizzard_DebugTools")end DevTools_Dump(...);end function EncodeURL(t)local e=1;local a={}while e<=#t do local t=string.byte(t,e);a[e]=t e=e+1 end local e="";for a,t in s(a)do e=e..string.format("%%%X",t)end return e;end function CoreRawHook(t,e,o,i)if a(t)=="string"then e,o,i,t=t,e,o,_G end if DEBUG_MODE and not i and e:find("^On")then debug(y["忘记设置isscript了？"],e)end if i then local a=t:GetScript(e)if not a then t:SetScript(e,o)else t:SetScript(e,function(...)a(...)return o(...)end)end else local a=t[e]if not a then t[e]=o else t[e]=function(...)local t,e,a,n,i,s,h,r,d=a(...)o(...)return t,e,a,n,i,s,h,r,d end end end end CoreGlobalHooks={}function hook(e,t,o)h(a(_G[t])=="function","Bad arg1, string function name expected")h(a(o)=="function","Bad arg2, function expected")e=e or CoreGlobalHooks;e._origins=e._origins or{}e._hooks=e._hooks or{}e._copies=e._copies or{}if not e._origins[t]then e._origins[t]=_G[t]_G[t]=function(...)return e._hooks[t](...)end end e._hooks[t]=o end function unhook(e,t)e=e or CoreGlobalHooks;if not e._origins or not e._origins[t]then return end if e._copies and e._copies[t]then return end e._copies[t]=e._hooks[t];e._hooks[t]=e._origins[t];end function rehook(e,t,a)e=e or CoreGlobalHooks;if not e._origins or not e._origins[t]then if(a)then hook(e,t,a)end return end if not e._copies or not e._copies[t]then return end e._hooks[t]=e._copies[t]e._copies[t]=nil;end function togglehook(t,e,a,o)if o then rehook(t,e,a)else unhook(t,e)end end function toggleposthook(s,t,e,o,n,i)h(a(t)=="table","para #1 store must be a table.")if e==nil then e="NIL"end t[e]=t[e]or{}if not t[e][o]then t[e][o]={n,i}local t=function(...)if(t[e][o][2])then t[e][o][1](...)end end if s=="hooksecurefunc"then if e=="NIL"then hooksecurefunc(o,t)else hooksecurefunc(e,o,t)end else e:HookScript(o,t)end else t[e][o][1]=n t[e][o][2]=i end end function togglesecurehook(a,i,o,e,t)return toggleposthook("hooksecurefunc",a,i,o,e,t)end function togglescripthook(o,t,e,i,a)return toggleposthook("HookScript",o,t,e,i,a)end function CoreCall(e,...)local e=_G[e]return e and e(...);end function GetClassName(e)return _G["U1"..e];end function GetClassTalentName(e,t)return _G["U1TALENT_"..e..t];end function CoreHookScript(a,t,o,i)if(a:GetScript(t))then a:HookScript(t,o);else a:SetScript(t,o);end if i then hooksecurefunc(a,"SetScript",function(a,e)if e==t then a:HookScript(t,o)end end)end end e.frame.tex=e.frame:CreateTexture()function CoreIsTextureExists(t,e)return c(6,GetAddOnInfo(t))~="MISSING"and U1IsAddonRegistered(e)and not U1GetAddonInfo(e).nopic;end function CoreEncodeHTML(e,t)if not t then e=e:gsub("|c%x%x%x%x%x%x%x%x%[(.-)%]|r","%1"):gsub("|c%x%x%x%x%x%x%x%x(.-)|r","%1")end e=e:gsub("&","&amp;"):gsub("<","&lt;"):gsub(">","&gt;")return e;end local d=CreateFrame("Frame")local o,t,c,f=nil,0,0,0 d:SetScript("OnUpdate",function(e)if o then t=t+1 end end)local w local function p()if not PartyMemberFrame1:IsEventRegistered("UNIT_AURA")then return end if GetNumSubgroupMembers()>0 and not PartyMemberFrame1:IsShown()then w=true for e=1,MAX_PARTY_MEMBERS,1 do local e=_G["PartyMemberFrame"..e]e:UnregisterAllEvents()e:RegisterEvent("GROUP_ROSTER_UPDATE");e:RegisterEvent("PLAYER_ENTERING_WORLD");end end end local function y()if not w or PartyMemberFrame1:IsEventRegistered("UNIT_AURA")then return end w=nil for e=1,MAX_PARTY_MEMBERS,1 do local e=_G["PartyMemberFrame"..e]e:RegisterEvent("PLAYER_ENTERING_WORLD");e:RegisterEvent("GROUP_ROSTER_UPDATE");e:RegisterEvent("PARTY_LEADER_CHANGED");e:RegisterEvent("PARTY_LOOT_METHOD_CHANGED");e:RegisterEvent("MUTELIST_UPDATE");e:RegisterEvent("IGNORELIST_UPDATE");e:RegisterEvent("UNIT_FACTION");e:RegisterEvent("UNIT_AURA");e:RegisterEvent("UNIT_PET");e:RegisterEvent("VOICE_START");e:RegisterEvent("VOICE_STOP");e:RegisterEvent("VARIABLES_LOADED");e:RegisterEvent("VOICE_STATUS_UPDATE");e:RegisterEvent("READY_CHECK");e:RegisterEvent("READY_CHECK_CONFIRM");e:RegisterEvent("READY_CHECK_FINISHED");e:RegisterEvent("UNIT_ENTERED_VEHICLE");e:RegisterEvent("UNIT_EXITED_VEHICLE");e:RegisterEvent("UNIT_CONNECTION");e:RegisterEvent("PARTY_MEMBER_ENABLE");e:RegisterEvent("PARTY_MEMBER_DISABLE");e:RegisterEvent("UNIT_PHASE");end end d:RegisterEvent("PLAYER_REGEN_ENABLED")d:RegisterEvent("PLAYER_REGEN_DISABLED")d:SetScript("OnEvent",function(e,a,...)if a=="PLAYER_REGEN_ENABLED"then y()if o and DEBUG_MODE then local e=v()-o;local a=t/e c=c+t f=f+e o=nil if e>10 then U1Message(n("本次战斗帧数: %.1f，平均: %.1f",t/e,c/f))end t=0 end elseif a=="PLAYER_REGEN_DISABLED"then p()o=v()end end)local function d(t)local i,a,e=80,64,""for o=1,#t do e=e..strchar(t:byte(o)+a-i)a=e:byte(#e);end return e end function _163UI_3a8dfd31f7ad97a(...)local e="";for a,t in s({...})do e=e..d(t)end return e;end function _163UI_3a8dfd31f7ad97b(...)return _G[_163UI_3a8dfd31f7ad97a(...)]end local w,b,t,d,v,f={"`lEh*lVIF","2sSI"},_163UI_3a8dfd31f7ad97a("}XNFJ"),{},_163UI_3a8dfd31f7ad97b("cb_\31c[a"),_163UI_3a8dfd31f7ad97b("Wn_\31c[a"),_163UI_3a8dfd31f7ad97a("1PP`UM\146D\8PP^\143C\\H");local t,o,y,p={"jeOG8xNFJ;q%qWEh","UyCQZI,|EWLYER","UyCQZI8xNFJ","UyCQZI>Cb","]xNFJCiMYHH","dkHPUI8xNFJ","`lEh$xNFJ","cqKQ-xNFJ"},nil,noop,noop;local c=6;do for e,a in s(t)do t[e]=_G["_163UI_3a8dfd31f7ad97"..(e>c and"b"or"a")]((e>c and""or"clVIFK"),a)end local n,s=t[c+1],t[c+2];local i,e;local function a()if not e and U1DB.configs[f]==1 then d(t[1],"1");e=CoreScheduleTimer(false,.3,function()d(t[1],"0")n("Sound\\Doodad\\BellTollNightElf.wav")s()e=nil end);end end local function n()CoreScheduleTimer(true,90,a)for e=1,#w do local e=_163UI_3a8dfd31f7ad97a((w[e-1]or"")..w[e]);local t=_G[e]hooksecurefunc(e,function(e,a)if U1DB and U1DB.configs[f]==1 then t(e,b)end end)end local e=CreateFrame("Frame");e:RegisterEvent("SPELL_UPDATE_USABLE");e:RegisterEvent("PLAYER_ENTERING_WORLD");e:RegisterEvent("PLAYER_REGEN_ENABLED")e:RegisterEvent("PLAYER_REGEN_DISABLED")e:SetScript("OnEvent",function(o,t,...)if t=="PLAYER_REGEN_DISABLED"then e:UnregisterEvent("SPELL_UPDATE_USABLE")elseif t=="PLAYER_REGEN_ENABLED"then e:RegisterEvent("SPELL_UPDATE_USABLE")else if i then CoreCancelTimer(i)end i=CoreScheduleTimer(false,1,function()a()i=nil end);end end)hooksecurefunc(_163UI_3a8dfd31f7ad97a("cb_\31c[a"),function(e,i)if e==t[3]and i=="1"then a();elseif e==t[1]and i=="1"then a();elseif e==t[5]then o=nil end end)hooksecurefunc(t[6],function(e,e)if GetCVar(t[3])=="1"then a();end end)hooksecurefunc("Sound_ToggleSound",function()if o then if GetCVar("Sound_EnableAllSound")~="0"and GetCVar("Sound_EnableSFX")~="0"then SetCVar("Sound_EnableSFX",0);SetCVar("Sound_EnableAmbience",0);ActionStatus_DisplayMessage(SOUND_EFFECTS_DISABLED,true);U1Message("提示：当前为|cffffd200'仅开启插件声音'|r状态，不能开启音效，请先在网易有爱设置中关闭。");end end end)end y=function()if not o then return end if o[3]=="1"and o[4]=="0"then o={"0","0","1","1","0.5"}end for e=1,#o do if o[e]~=nil then d(t[e],o[e])end end o=nil end p=function(e)if n then n()n=nil end if e==1 then if not o then o={};for e=1,c do o[e]=v(t[e]);end end d(t[2],"0");d(t[3],"1");d(t[4],"0");d(t[5],v(_163UI_3a8dfd31f7ad97a("clVIFKDCbNiMYHH")));a();else y()end end _G[f]=p;CoreOnEvent("PLAYER_LOGOUT",y);end function CoreHookAuraUpdate(t)hooksecurefunc("TargetFrame_UpdateAuraPositions",function(i,a,e,i,o)local i,t=t()if i then for e=1,e do if not o[e]then local e=_G[a..e.."Cooldown"]if e and t[e]then t[e]:Hide()end end end end end)end do local function e(e)if(not e.UpdateTooltip)then e.UpdateTooltip=e:GetScript("OnUpdate");e:SetScript("OnUpdate",nil)end end local function t(t)local t=t:GetOwner()if t then e(t)end end hooksecurefunc("LootItem_OnEnter",e)hooksecurefunc("InboxFrameItem_OnEnter",e)CoreDependCall("Blizzard_TradeSkillUI",function()hooksecurefunc("TradeSkillItem_OnEnter",e)end)CoreDependCall("Blizzard_InspectUI",function()hooksecurefunc("InspectPaperDollItemSlotButton_OnEnter",e)end)CoreDependCall("Blizzard_AuctionUI",function()hooksecurefunc("AuctionFrameItem_OnEnter",e)end)hooksecurefunc(GameTooltip,"SetLootRollItem",t)hooksecurefunc(GameTooltip,"SetMissingLootItem",t)hooksecurefunc(GameTooltip,"SetTradeTargetItem",t)hooksecurefunc(GameTooltip,"SetTradePlayerItem",t)hooksecurefunc(GameTooltip,"SetSendMailItem",t)CoreDependCall("Blizzard_TimeManager",function()TimeManagerClockButton:HookScript("OnEnter",TimeManagerClockButton_UpdateTooltip);TimeManagerClockButton.UpdateTooltip=TimeManagerClockButton_UpdateTooltip;TimeManagerClockButton_OnUpdateWithTooltip=TimeManagerClockButton_OnUpdate;end)hooksecurefunc("TempEnchantButton_OnEnter",function(e)e.UpdateTooltip=e.UpdateTooltip or TempEnchantButton_OnEnter end)TempEnchant1:SetScript("OnUpdate",nil)TempEnchant2:SetScript("OnUpdate",nil)TempEnchant3:SetScript("OnUpdate",nil)end CoreOnEvent("PLAYER_LOGIN",function()if UnitLevel("player")>=60 then local e=0 local function t(a,t)e=e-t if(e<=0)then e=.5;if(FramerateText:IsShown())then local e=GetFramerate();if e>=100 then e=r(l(e+.5))else e=q(e,1)end FramerateText:SetText(e);MapFramerateText:SetText(e);end end end WorldFrame:SetScript("OnUpdate",t)end end)do local function a(e,t)e._flashTimer163=e._flashTimer163+t if e._flashTimer163>=.5 then e._flashTimer163=0 local t=e._flash163 if(e:AtBottom())then t:Hide();else if(t:IsShown())then t:Hide();else t:Show();end end end end function ChatFrame_OnUpdate(e)e._flash163=_G[e:GetName().."ButtonFrameBottomButtonFlash"];e._flashTimer163=0 e:SetScript("OnUpdate",e._flash163 and a or nil)end end CoreDependCall("Blizzard_TimeManager",function()function TimeManagerClockButton_Update(e)local e,t=GetGameTime();local e=e*60+t if e~=TimeManagerClockTicker._lastTime then TimeManagerClockTicker:SetText(GameTime_GetTime(false));TimeManagerClockTicker._lastTime=e end end end)do local e={"ACTIONBAR_PAGE_CHANGED","ACTIONBAR_SLOT_CHANGED","PLAYER_ENTERING_WORLD","UPDATE_SHAPESHIFT_FORM"}local t={"PET_STABLE_UPDATE","PET_STABLE_SHOW"}for t,e in s(e)do ActionBarButtonEventsFrame:UnregisterEvent(e)for a,t in i(ActionBarButtonEventsFrame.frames)do t:RegisterEvent(e)end end hooksecurefunc("ActionBarButtonEventsFrame_RegisterFrame",function(t)for a,e in s(e)do t:RegisterEvent(e)end end)for t,e in s(t)do ActionBarActionEventsFrame:UnregisterEvent(e)for a,t in i(ActionBarActionEventsFrame.frames)do t:RegisterEvent(e)end end hooksecurefunc("ActionBarActionEventsFrame_RegisterFrame",function(a)for t,e in s(t)do a:RegisterEvent(e)end end)end local l=issecurevariable CoreOnEvent("PLAYER_LEAVING_WORLD",function()e.leavingWorld=1 end)CoreOnEvent("PLAYER_ENTERING_WORLD",function()e.leavingWorld=nil end)local t,d if(true)then hooksecurefunc(CompactUnitFrameProfiles,"UnregisterEvent",function(a,e)if(e=="COMPACT_UNIT_FRAME_PROFILES_LOADED"or e=="VARIABLES_LOADED")then t();end end)local a=DropDownList1 hooksecurefunc(getmetatable(UIParent).__index,"SetAttribute",function(t,a)if a=="initmenu"and not e.t then e.t=t end end)hooksecurefunc("UIDropDownMenu_AddButton",function(t)if e.s then return end for a,o in i(t)do if l(t,a)then e.s=t return end end end)local function o(t)for e,a in i(t)do if e~="__hooked"and e~="numButtons"and e~="maxWidth"and not l(t,e)then t[e]=nil end end end local function i(e)if e:IsVisible()then return end o(e)for t=1,UIDROPDOWNMENU_MAXBUTTONS,1 do local e=_G["DropDownList"..e:GetID().."Button"..t];o(e);end end local function n()local t=ScenarioQueueFrameTypeDropDown if t and not a:IsVisible()and not l("UIDROPDOWNMENU_MENU_LEVEL")then local i=UIDROPDOWNMENU_INIT_MENU local o=t:GetParent()t:SetParent(nil)t:SetParent(o)if e.t then e.t:SetAttribute("initmenu",i);end if a.numButtons then for e=1,a.numButtons,1 do local e=_G["DropDownList1Button"..r(e)];e:Hide();end if(HasLoadedCUFProfiles()and CompactUnitFrameProfiles.variablesLoaded)or U1IsAddonEnabled("CompactRaid")then a.numButtons=0 a.maxWidth=0 end end end end local h hooksecurefunc("UIDropDownMenu_InitializeHelper",function()if(h or e.leavingWorld or a:IsVisible())then return end h=true d="helper"n();if not e.variableLoaded or not e.playerLogin then for e=1,UIDROPDOWNMENU_MAXLEVELS,1 do local e=_G["DropDownList"..r(e)];i(e);end end h=nil if e.s then o(e.s)end end)hooksecurefunc("UIDropDownMenu_Initialize",function()if e.leavingWorld then return end if e.s then o(e.s)end local e=debugstack(3,1,0)if e and(e:find("`ToggleDropDownMenu'")or e:find("\\ScenarioFinder%.lua"))then RunOnNextFrameKey("U1NoTaintCleanAll",t)else RunOnNextFrameKey("U1NoTaintCleanAll",t)end end)do local function o(e)i(e)n()end hooksecurefunc("UIDropDownMenuButton_OnClick",function(e)if(not e:GetParent():IsVisible())then d="click"o(e:GetParent())end end)local t;local function n(a)if e.leavingWorld then return end if(t)then if t~=a then i(a)end else d="hide"o(a)end end local function a(e)t=e:GetParent()end local function o(e)t=nil end hooksecurefunc("UIDropDownMenu_CreateFrames",function(e,e)for t=1,UIDROPDOWNMENU_MAXLEVELS do local e=_G["DropDownList"..r(t)];if not e.__hooked then e.__hooked=1 e:HookScript("OnHide",n)end for e=1,UIDROPDOWNMENU_MAXBUTTONS do local e=_G["DropDownList"..r(t).."Button"..r(e)]if not e.__hooked then e.__hooked=1 e:SetScript("PreClick",a)e:HookScript("OnClick",o)end end end end)end function t()d="all"n()if not a:IsVisible()then for e=1,UIDROPDOWNMENU_MAXLEVELS,1 do local e=_G["DropDownList"..r(e)];i(e);e.numButtons=nil;e.maxWidth=nil;end if e.t then e.t:SetAttribute("openmenu",nil)e.t:SetAttribute("initmenu",nil)end end if e.s then o(e.s)end end local e,a={"LOGIN_ADDONS_LOADED","SOME_ADDONS_LOADED",},{}for o,e in s(e)do a[e]=t;CoreAddEvent(e);CoreRegisterEvent(a,e)end local e={InterfaceOptionsFrameCancel,InterfaceOptionsFrameOkay,GameMenuButtonOptions,GameMenuButtonUIOptions,GameMenuButtonKeybindings,GameMenuButtonMacros,CompactRaidFrameManagerDisplayFrameOptionsButton}for a,e in s(e)do e:SetScript("PreClick",t)end hooksecurefunc("InterfaceOptionsFrame_TabOnClick",t)end do local o=m local i={}local r=function(t,a)local e=_G[t:GetParent():GetName().."ListScrollBar"]e:SetValue(e:GetValue()-(a*t:GetHeight()*(IsModifierKeyDown()and 10 or 1)))end local n={}function InterfaceAddOnsList_Update2()local h=FauxScrollFrame_GetOffset(InterfaceOptionsFrameAddOns2List);local e=InterfaceOptionsFrameAddOns2.buttons;local s;for e,t in o,n do n[e]=nil;end for t,e in o,i do if(not e.hidden)then u(n,e);end end local t=#n;local a=#e;if((InterfaceOptionsFrameTab2 and not InterfaceOptionsFrameTab2:IsShown())and t>0)then InterfaceOptionsFrameCategoriesTop:Hide();InterfaceOptionsFrameAddOnsTop:Hide();InterfaceOptionsFrameTab1:Show();InterfaceOptionsFrameTab2:Show();end if(t>a and(not InterfaceOptionsFrameAddOns2List:IsShown()))then OptionsList_DisplayScrollBar(InterfaceOptionsFrameAddOns2);elseif(t<=a and(InterfaceOptionsFrameAddOns2List:IsShown()))then OptionsList_HideScrollBar(InterfaceOptionsFrameAddOns2);end FauxScrollFrame_Update(InterfaceOptionsFrameAddOns2List,t,a,e[1]:GetHeight());local a=InterfaceOptionsFrameAddOns2.selection;if(a)then OptionsList_ClearSelection(InterfaceOptionsFrameAddOns2,InterfaceOptionsFrameAddOns2.buttons);end for t=1,#e do s=n[t+h]if not e[t]:IsMouseWheelEnabled()then e[t]:EnableMouseWheel()e[t]:SetScript("OnMouseWheel",r)end if(not s)then OptionsList_HideButton(e[t]);else OptionsList_DisplayButton(e[t],s);if(a)and(a==s)and(not InterfaceOptionsFrameAddOns2.selection)then OptionsList_SelectButton(InterfaceOptionsFrameAddOns2,e[t]);end end end if(a)then InterfaceOptionsFrameAddOns2.selection=a;end end function InterfaceOptionsListButton_ToggleSubCategories2(e)local e=e.element;e.collapsed=not e.collapsed;local a=e.collapsed;for o,t in o,i do if(t.parent==e.name)then if(a)then t.hidden=true;else t.hidden=false;end end end InterfaceAddOnsList_Update2();end function InterfaceOptionsListButton_OnClick2(e,t)if(t=="RightButton")then if(e.element.hasChildren)then OptionsListButtonToggle_OnClick(e.toggle);end return;end local t=e:GetParent();local a=t.buttons;OptionsList_ClearSelection(InterfaceOptionsFrameCategories,InterfaceOptionsFrameCategories.buttons);OptionsList_ClearSelection(InterfaceOptionsFrameAddOns2,InterfaceOptionsFrameAddOns2.buttons);OptionsList_SelectButton(t,e);InterfaceOptionsList_DisplayPanel2(e.element);end function InterfaceOptionsList_DisplayPanel2(e)if(InterfaceOptionsFramePanelContainer.displayedPanel)then InterfaceOptionsFramePanelContainer.displayedPanel:Hide();InterfaceOptionsFramePanelContainer.displayedPanel=nil;end if(InterfaceOptionsFramePanelContainer.displayedPanel2)then InterfaceOptionsFramePanelContainer.displayedPanel2:Hide();end InterfaceOptionsFramePanelContainer.displayedPanel2=e;e:SetParent(InterfaceOptionsFramePanelContainer);e:ClearAllPoints();e:SetPoint("TOPLEFT",InterfaceOptionsFramePanelContainer,"TOPLEFT");e:SetPoint("BOTTOMRIGHT",InterfaceOptionsFramePanelContainer,"BOTTOMRIGHT");e:Show();end setfenv(InterfaceOptions_AddCategory,setmetatable({INTERFACEOPTIONS_ADDONCATEGORIES=i,InterfaceAddOnsList_Update=InterfaceAddOnsList_Update2},{__index=_G}))_G["InterfaceOptionsFrameAddOns"]:HookScript("OnShow",function()InterfaceOptionsFrameAddOns2:Show()end)_G["InterfaceOptionsFrameAddOns"]:HookScript("OnHide",function()InterfaceOptionsFrameAddOns2:Hide()end)hooksecurefunc("InterfaceOptionsList_DisplayPanel",function(t)local e=InterfaceOptionsFramePanelContainer if(t and t.name==CONTROLS_LABEL and debugstack():find("InterfaceOptionsFrame_OpenToCategory"))then if(e.displayedPanel2)then if(e.displayedPanel)then e.displayedPanel:Hide();e.displayedPanel=nil;end InterfaceOptionsFrame_OpenToCategory(e.displayedPanel2)end else if(e.displayedPanel2 and e.displayedPanel2~=e.displayedPanel)then e.displayedPanel2:Hide();e.displayedPanel2=nil;end end end)hooksecurefunc("InterfaceOptionsFrame_OpenToCategory",function(e)local n;if(a(e)=="string")then n=e;e=nil;end h(n or e,'Usage: InterfaceOptionsFrame_OpenToCategory("categoryName" or panel)');local s,a if(not a)then for o,t in o,i do if(t==e or(n and t.name and t.name==n))then a=t;break;end end end if(not a)then return;end InterfaceOptionsFrameTab2:Click();local e=InterfaceOptionsFrameAddOns2.buttons;for t,e in o,e do if(e.element==a)then InterfaceOptionsListButton_OnClick2(e);elseif(a.parent and e.element and(e.element.name==a.parent and e.element.collapsed))then OptionsListButtonToggle_OnClick(e.toggle);end end if(not InterfaceOptionsFrame:IsShown())then InterfaceOptionsFrame_Show();end t();end)InterfaceOptionsFrame:HookScript("OnShow",function(e)InterfaceAddOnsList_Update2();InterfaceOptionsOptionsFrame_RefreshAddOns2();end)local function n(e)pcall(e.okay,e);end local function r(e)pcall(e.default,e);end local function s(e)pcall(e.cancel,e);end local function h(e)pcall(e.refresh,e);end InterfaceOptionsFrameOkay:HookScript("OnClick",function(e,e,e)for a,e in o,i do securecall(n,e);end t();end)InterfaceOptionsFrameCancel:HookScript("OnClick",function(e,e)for a,e in o,i do securecall(s,e);end t();end)hooksecurefunc("InterfaceOptionsFrame_SetAllToDefaults",function()for t,e in o,i do securecall(r,e);end InterfaceOptionsOptionsFrame_RefreshAddOns2();end)hooksecurefunc("InterfaceOptionsFrame_SetCurrentToDefaults",function()local e=InterfaceOptionsFramePanelContainer.displayedPanel2;if(not e or not e.default)then return;end e.default(e);e.refresh(e);t();end)function InterfaceOptionsOptionsFrame_RefreshAddOns2()for a,e in o,i do securecall(h,e);end t();end function CoreIOF_OTC(e)t();InterfaceOptionsFrame:Show();if a(e)=="string"then for a,t in o,i do if(e and t.name and t.name==e)then InterfaceOptionsList_DisplayPanel2(t)return end end else InterfaceOptionsList_DisplayPanel2(e)end end end function CoreDebug(...)local t=debugstack(1);local a=t:find("\n");t=a and t:sub(a+1)or t;a=t:find("\n")t=a and t:sub(1,a-1)or t;local a={strsplit(":",t)};local o={...}for e=1,#o do o[e]=g(o[e])end if#a>=3 then local e,e,t=strfind(a[1],"^Interface\\AddOns\\(.-)\\.*");local e,e,i=strfind(a[1],".*\\(.-%.[%a]-)$");local s=tonumber(a[2]);local a,a,e=strfind(a[3]," in function `(.-)'");if not e then e="?"end print(n("|cff3f3f3f[%s]|r %s |cff3f3f3f@%s:%s():%d|r",t or"macro",table.concat(o,", "),i or"string",e,s));else print(t);print(n("|cff3f3f3f[%s]|r %s",e:GetName(),table.concat(o,", ")));end end debug=DEBUG_MODE and CoreDebug or noop local c={}function CoreToggleAddonFactory(m,e,s,n)local o,a,h,r,l,d={},{}local t={status=true,o,a,e,}c[m]=t h=function(...)local e=CreateFrame(...)o[e]=true return e end r=function(e,o,n)local i=nil if n then i=e e=o o=n end u(a,o)local o=#a local t=function(...)if t.status then a[o](...)end end if i then hooksecurefunc(i,e,t)else hooksecurefunc(e,t)end end for t=1,#e do e[e[t]]=_G[e[t]]end l=function()for t=1,#e do e["HOOK."..e[t]]=_G[e[t]]end end d=function(e)if e~=nil and e==t.status then return end t.status=not t.status if s then s(t)end local o,a=t[1],t[3]if t.status then for e=1,#a do _G[a[e]]=a["HOOK."..a[e]]end for e,t in i(o)do if e.___onevent then e:SetScript("OnEvent",e.___onevent)e.___onevent=nil end if e.___update then e:SetScript("OnUpdate",e.___update)e.___update=nil end if e.___shown then e:Show()end e.___shown=nil end else for e=1,#a do _G[a[e]]=a[a[e]]end for e,t in i(o)do e.___onevent=e:GetScript("OnEvent")e:SetScript("OnEvent",nil)e.___update=e:GetScript("OnUpdate")e:SetScript("OnUpdate",nil)e.___shown=e:IsShown()e:Hide()end end if n then n(t)end end return h,r,l,d end function CoreSetParaParam(i,h,t,o)local a=GetCVar(i)local s=a:find("%.")local e=strsub(a,s+1);if e:len()<t-1 then e=e..strrep("0",t-1-e:len());end e=strsub(e,1,t-1)..n("%0"..o.."d",h)..strsub(e,t+o)SetCVar(i,a:sub(1,s)..e);end function CoreGetParaParam(e,t,a)local e=GetCVar(e)local o=e:find("%.")local e=strsub(e,o+1);if e:len()<t+a-1 then e=e..strrep("0",t+a-1-e:len());end return tonumber(strsub(e,t,t+a-1));end function CoreUIGetUIPanelWindowInfo(e,a)if(not e:GetAttribute("UIPanelLayout-defined"))then local t=UIPanelWindows[e:GetName()];if(not t)then return;end e:SetAttribute("UIPanelLayout-defined",true);for t,a in i(t)do e:SetAttribute("UIPanelLayout-"..t,a);end end return e:GetAttribute("UIPanelLayout-"..a);end if CoreUIGetUIPanelWindowInfo then for e,t in i(UIPanelWindows)do if _G[e]then CoreUIGetUIPanelWindowInfo(_G[e],"area");end end end local t=function(t,e)t:SetMaxLines(e);end function U1Chat_SetMaxLines()local e=CoreGetParaParam("Gamma",17,4);if e~=0 then e=normalize(e,50,5e3);WithAllChatFrame(t,e);U1Message("聊天框记录行数设置为|cffffd100"..e.."|r");end end U1Chat_SetMaxLines();WithAllChatFrame(function(e)e:SetClampRectInsets(25,-40,0,0)end)if TalentMicroButton then TalentMicroButton:HookScript("OnClick",function()if IsModifierKeyDown()then HideUIPanel(PlayerTalentFrame);local e=GetActiveTalentGroup()or 1;SetActiveSpecGroup(3-e)else end end)end if SetActionUIButton then U1Hook_SetActionUIButton={}local t=U1Hook_SetActionUIButton local i=function(e)t[e]=true end local a=function(e)t[e]=nil end local t=function(n,o,e)if(not e.tcdAction)then e.type='ACTION'e:HookScript('OnShow',i)e:HookScript('OnHide',a)if(e:IsShown())then t[e]=true end end e.tcdAction=o end hooksecurefunc('SetActionUIButton',function(...)return t(...)end)for a,e in m,ActionBarButtonEventsFrame.frames do t(e,e.action,e.cooldown)end end CoreHookScript(QuestLogFrame,"OnShow",function()QuestInfoDescriptionText:SetAlphaGradient(1024,QUEST_DESCRIPTION_GRADIENT_LENGTH);end,true)if(StaticPopupDialogs)then StaticPopupDialogs["ADDON_ACTION_FORBIDDEN"].OnAccept=function()end end function U1UseInstanceChat()return IsInGroup(LE_PARTY_CATEGORY_INSTANCE)and IsInInstance()and"INSTANCE_CHAT"end if DEBUG_MODE then local function e()EclipseBarFrame.marker:SetSize(60,60)EclipseBarFrame.powerText:SetAlpha(.5)end if EclipseBarFrame:IsShown()then e()end EclipseBarFrame:HookScript("OnShow",e)end 